<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>statistics.rb</title>
  <link rel="stylesheet" href="http://jashkenas.github.com/docco/resources/docco.css">
</head>
<body>
<div id='container'>
  <div id="background"></div>
  <div id="jump_to">
    Jump To &hellip;
    <div id="jump_wrapper">
      <div id="jump_page">
          <a class="source" href="../subscription_counter.html">subscription_counter.rb</a>
          <a class="source" href="campaign.html">campaign.rb</a>
          <a class="source" href="data_point.html">data_point.rb</a>
          <a class="source" href="data_series.html">data_series.rb</a>
          <a class="source" href="graph.html">graph.rb</a>
          <a class="source" href="report.html">report.rb</a>
          <a class="source" href="report/pdf.html">pdf.rb</a>
          <a class="source" href="statistics.html">statistics.rb</a>
      </div>
    </div>
  </div>
  <table cellspacing=0 cellpadding=0>
  <thead>
    <tr>
      <th class=docs><h1>statistics.rb</h1></th>
      <th class=code></th>
    </tr>
  </thead>
  <tbody>
    <tr id='section-1'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-1">&#182;</a>
        </div>
        <p>The <code>Statistics</code> object is a thin wrapper over a computation that my report
uses to guess at what the average change in subscriber count per week is. It
originally used a lot more code than what it currently does, but now that this
report uses R for graphing, I decided to use it for computing the mean and
standard deviation of datasets as well.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="k">module</span> <span class="nn">SubscriptionCounter</span>
  <span class="no">Statistics</span> <span class="o">=</span> <span class="no">Object</span><span class="o">.</span><span class="n">new</span>

  <span class="k">class</span> <span class="o">&lt;&lt;</span> <span class="no">Statistics</span> </pre></div>
      </td>
    </tr>
    <tr id='section-2'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-2">&#182;</a>
        </div>
        <hr/>

<p>The <code>adjusted_mean</code> method takes an array of numbers and computes its mean
and standard deviation. This information is used to determine which points
should be treated as outliers and removed from the dataset.</p>

<p>The reason I implemented this function is that it isn&rsquo;t uncommon for
Practicing Ruby to see a huge bump when it gets mentioned somewhere, but
the change in subscribers in that pariticular week won&rsquo;t be nearly 
representative of the &ldquo;average week&rdquo;.I want to use average subscriber
increase as a metric for how well Practicing Ruby is growing, but I don&rsquo;t
want have false expectations about its growth rate due to outliers.</p>

      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="k">def</span> <span class="nf">adjusted_mean</span><span class="p">(</span><span class="n">list</span><span class="p">)</span>
      <span class="n">r</span> <span class="o">=</span> <span class="no">RSRuby</span><span class="o">.</span><span class="n">instance</span>

      <span class="n">mean</span>    <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">list</span><span class="p">)</span>
      <span class="n">std_dev</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">sd</span><span class="p">(</span><span class="n">list</span><span class="p">)</span>

      <span class="n">lower_limit</span> <span class="o">=</span> <span class="n">mean</span> <span class="o">-</span> <span class="n">std_dev</span>
      <span class="n">upper_limit</span> <span class="o">=</span> <span class="n">mean</span> <span class="o">+</span> <span class="n">std_dev</span>

      <span class="n">list_without_outliers</span> <span class="o">=</span> <span class="n">list</span><span class="o">.</span><span class="n">select</span> <span class="k">do</span> <span class="o">|</span><span class="n">e</span><span class="o">|</span>
        <span class="p">(</span><span class="n">lower_limit</span><span class="o">.</span><span class="n">.upper_limit</span><span class="p">)</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
      <span class="k">end</span>

      <span class="n">r</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">list_without_outliers</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></pre></div>
      </td>
    </tr>
  </table>
</div>
</body>
